!function(e,t){"use strict";function r(e){var r=t.querySelector(e),n=t.createElement("button");return n.href="#",n.className="drtrial-menubtn drtrial-insertsprite",n.textContent="Insert Sprite",r.insertBefore(n,r.firstElementChild),n}function n(){var e=t.createElement("label"),r=t.createElement("input"),n=t.createElement("span");return e.className="help-toggle drtrial-menuopt",r.className="drtrial-showspoilers",r.type="checkbox",n.textContent="Show spoiler sprites",e.appendChild(r),e.appendChild(n),{box:r,body:e}}function l(e,t){if("IMG"==t.target.nodeName){var r=0,n=e.parentNode.querySelector("input.drtrial-formfinder").form,l=n.querySelector(".usertext-edit textarea");l.textLength>0&&(l.value+="\n\n"),r=l.textLength,l.value+="[A few words of the]("+t.target.src+") comment",l.focus(),l.setSelectionRange(r+1,r+19),this.remove(),e=null,n=null,l=null}}function a(e){for(var r=t.querySelectorAll(".drtrial-spritespoiler"),n=r.length;n--;)r[n].hidden=!this.checked;r=null}-1!=t.title.toLowerCase().indexOf("class trial")&&(r(".usertext-edit .bottom-area"),t.querySelector(".commentarea").addEventListener("click",function(r){if(r.target.classList.contains("drtrial-insertsprite")){r.preventDefault(),r.stopPropagation();for(var i=t.querySelectorAll(".drtrial-modal"),o=i.length;o--;)i[o].remove();chrome.runtime.sendMessage({character:e.currentFlair},function(i){var o=e.createModal("SPRITE SELECTOR"),s=n();s.box.disabled=!i.spoilers.length,s.box.addEventListener("change",a,!1),o.menu.appendChild(s.body),i.total=i.sprites.length+i.spoilers.length,o.body.classList.add("drtrial-spritemenu"),o.body.style.width=94*Math.min(8,Math.ceil(i.total/5))+"px",o.body.addEventListener("click",l.bind(o.body,r.target),!0),t.body.appendChild(o.body),[].concat(i.sprites,i.spoilers).forEach(function(e,t){var r=new Image;r.src=e,r.className="drtrial-sprite",t>=i.sprites.length&&(r.classList.add("drtrial-spritespoiler"),r.hidden=!0),o.body.appendChild(r)}),o=null,s=null})}},!1))}(window.DRreddit,document);