!function(e){"use strict";function t(t){var r=e.createElement("input"),n=e.createElement("a");return n.href="#",n.className="help-toggle drtrial-menubtn",n.textContent="Insert DR sprite",t.insertBefore(n,t.firstElementChild),r.type="hidden",r.className="drtrial-formfinder",t.insertBefore(r,n),n}function r(t){var r,a=e.createElement("div");return a.className="drtrial-modal drtrial-spritemenu",a.style.width=t+"px",r=e.createElement("div"),r.className="title",r.textContent="DANGANREDDIT CLASS TRIAL HELPER",a.appendChild(r),r=e.createElement("div"),r.className="menu",i(r),n(r),a.appendChild(r),a}function n(t){var r=e.createElement("label"),n=e.createElement("input"),i=e.createElement("span");r.className="help-toggle drtrial-menuopt",n.className="drtrial-showspoilers",n.type="checkbox",n.addEventListener("change",function(t){for(var r=e.querySelectorAll(".drtrial-spritespoiler"),n=r.length;n--;)r[n].hidden=!this.checked;r=null}),i.textContent="Show spoiler sprites",r.appendChild(n),r.appendChild(i),t.insertBefore(r,t.firstElementChild)}function i(t){var r=e.createElement("button");r.textContent="Close",r.addEventListener("click",function(){this.parentNode.parentNode.remove()}),t.appendChild(r)}function a(){return e.querySelector("span.flair").className.replace("flair flair-","")}function l(){try{return e.querySelector(".drtrial-spoilersprites").checked}catch(t){return!1}}if(-1!=e.title.toLowerCase().indexOf("class trial")){var s=e.querySelector(".usertext-edit .bottom-area"),o=t(s);o.addEventListener("mouseover",function(e){this.textContent="Insert DR sprite ["+a()+"]"},!1),e.querySelector(".commentarea").addEventListener("click",function(t){if(t.target.classList.contains("drtrial-menubtn")){t.preventDefault(),t.stopPropagation();for(var n=e.querySelectorAll(".drtrial-spritemenu"),i=n.length;i--;)n[i].remove();chrome.runtime.sendMessage({character:a(),spoilers:l()},function(n){var i=n.sprites.length+n.spoilers.length,a=Math.min(8,Math.ceil(i/5)),l=r(94*a);e.body.appendChild(l),l.querySelector(".drtrial-showspoilers").disabled=!n.spoilers.length,n.sprites.forEach(function(e){if(e){var t=new Image;t.src=e,t.className="drtrial-sprite",l.appendChild(t)}}),n.spoilers.forEach(function(e){if(e){var t=new Image;t.src=e,t.className="drtrial-sprite drtrial-spritespoiler",t.hidden=!0,l.appendChild(t)}}),l.addEventListener("click",function(e){if("IMG"==e.target.nodeName){var r=0,n=t.target.previousElementSibling.form,i=n.querySelector(".usertext-edit textarea");i.textLength>0&&(i.value+="\n\n"),r=i.textLength,i.value+="[A few words of the]("+e.target.src+") comment",i.focus(),i.setSelectionRange(r+1,r+19),this.remove()}},!0)})}},!1),o=null,s=null}}(document);