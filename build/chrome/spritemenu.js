!function(e){"use strict";function t(t){var r=e.createElement("a");return r.href="#",r.className="help-toggle drtrial-menubtn",r.textContent="Insert DR sprite",t.insertBefore(r,t.firstElementChild),r}function r(t){var r,a=e.createElement("div");return a.className="drtrial-modal drtrial-spritemenu",a.style.width=t+"px",r=e.createElement("div"),r.className="title",r.textContent="DANGANREDDIT CLASS TRIAL HELPER",a.appendChild(r),r=e.createElement("div"),r.className="menu",i(r),n(r),a.appendChild(r),a}function n(t){var r=e.createElement("label"),n=e.createElement("input"),i=e.createElement("span");r.className="help-toggle drtrial-menuopt",n.className="drtrial-showspoilers",n.type="checkbox",n.addEventListener("change",function(t){for(var r=e.querySelectorAll(".drtrial-spritespoiler"),n=r.length;n--;)r[n].hidden=!this.checked;r=null}),i.textContent="Show spoiler sprites",r.appendChild(n),r.appendChild(i),t.insertBefore(r,t.firstElementChild)}function i(t){var r=e.createElement("button");r.textContent="Close",r.addEventListener("click",function(){this.parentNode.parentNode.remove()}),t.appendChild(r)}function a(){return e.querySelector("span.flair").className.replace("flair flair-","")}function l(){try{return e.querySelector(".drtrial-spoilersprites").checked}catch(t){return!1}}if(-1!=e.title.toLowerCase().indexOf("class trial")){var s=e.querySelector(".usertext-edit .bottom-area"),o=t(s);o.addEventListener("mouseover",function(e){this.textContent="Insert DR sprite ["+a()+"]"},!1),o.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation();for(var n=e.querySelectorAll("drtrial-spritemenu"),i=n.length;i--;)n[i].remove();chrome.runtime.sendMessage({character:a(),spoilers:l()},function(t){var n=t.sprites.length+t.spoilers.length,i=Math.min(8,Math.ceil(n/5)),a=r(94*i);e.body.appendChild(a),a.querySelector(".drtrial-showspoilers").disabled=!t.spoilers.length,t.sprites.forEach(function(e){if(e){var t=new Image;t.src=e,t.className="drtrial-sprite",a.appendChild(t)}}),t.spoilers.forEach(function(e){if(e){var t=new Image;t.src=e,t.className="drtrial-sprite drtrial-spritespoiler",t.hidden=!0,a.appendChild(t)}}),a.addEventListener("click",function(t){if("IMG"==t.target.nodeName){var r=0,n=e.querySelector(".usertext-edit textarea");n.textLength>0&&(n.value+="\n\n"),r=n.textLength,n.value+="[{Sprite}]("+t.target.src+") ",n.focus(),n.setSelectionRange(r+1,r+9),this.remove()}},!0)})},!1),o=null,s=null}}(document);